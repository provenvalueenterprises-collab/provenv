"use strict";(()=>{var e={};e.id=7007,e.ids=[7007],e.modules={8432:e=>{e.exports=require("bcryptjs")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},5900:e=>{e.exports=require("pg")},6154:(e,r,s)=>{s.r(r),s.d(r,{config:()=>d,default:()=>l,routeModule:()=>m});var n={};s.r(n),s.d(n,{default:()=>u});var i=s(1802),o=s(7153),a=s(6249),t=s(7725);async function u(e,r){if("POST"!==e.method)return r.status(405).json({message:"Method not allowed"});let{name:s,email:n,phone:i,password:o,referral_code:a}=e.body;if(console.log("\uD83D\uDCCB Registration request body:",{name:s,email:n||"not provided",phone:i||"not provided",password:o?"provided":"missing",referral_code:a}),!s||!o)return console.log("❌ Missing required fields: name or password"),r.status(400).json({message:"Name and password are required"});if(!i&&!n)return console.log("❌ Missing identifier: need phone or email"),r.status(400).json({message:"Either phone number or email address is required"});try{console.log("\uD83D\uDD04 Starting registration for:",n),console.log("\uD83D\uDD04 Creating user with userStore...");let e=await t.H.createUser({display_name:s,email:n||null,phone:i,phone_number:i,password:o});if(!e)throw console.log("❌ User creation returned null"),Error("Failed to create user - userStore returned null");console.log("✅ User created successfully:",{id:e.id,email:e.email,display_name:e.display_name,phone:e.phone});let a=`PV${Math.random().toString(36).substring(2,8).toUpperCase()}`;r.status(201).json({message:"Registration successful! You can now login with your credentials.",userId:e.id,needsVerification:!1,referralCode:a,emailSent:!1})}catch(s){if(console.error("❌ Registration error:",s),s instanceof Error){if(s.message.includes("duplicate key value violates unique constraint")){if(s.message.includes("users_email_key")||s.message.includes("email"))return r.status(400).json({message:"An account with this email address already exists. Please use a different email or try logging in.",error:"EMAIL_ALREADY_EXISTS"});if(s.message.includes("users_phone_number_key")||s.message.includes("phone_number"))return r.status(400).json({message:"An account with this phone number already exists. Please use a different phone number or try logging in.",error:"PHONE_ALREADY_EXISTS"})}if(s.message.includes("userStore returned null"))return r.status(400).json({message:"Registration failed. The email or phone number may already be in use.",error:"DUPLICATE_USER_DATA"})}let e=s instanceof Error?s.message:"Internal server error";r.status(500).json({message:e,error:s instanceof Error?s.message:"Unknown error"})}}let l=(0,a.l)(n,"default"),d=(0,a.l)(n,"config"),m=new i.PagesAPIRouteModule({definition:{kind:o.x.PAGES_API,page:"/api/auth/register",pathname:"/api/auth/register",bundlePath:"",filename:""},userland:n})}};var r=require("../../../webpack-api-runtime.js");r.C(e);var s=e=>r(r.s=e),n=r.X(0,[2002],()=>s(6154));module.exports=n})();